# 健康記録詳細ページ - 全検診結果表示機能

## 修正日時
2025年11月3日

## 問題の説明

以前の詳細ページでは、**クリックしたレコード1件の検診結果のみ**が表示されていました。

### 例
松葉さんには以下のレコードがあります：
- レコード#994: 耳鼻科検診（鼻・アレルギー性鼻炎）
- レコード#997: 内科検診（喘息）
- レコード#998: 耳鼻科検診（耳・滲出性中耳炎）
- レコード#993: 眼科検診（アレルギー性結膜炎）

しかし、レコード#997の詳細ボタンをクリックすると、**内科検診の結果のみ**が表示されていました。

## 修正内容

詳細ページを改修し、**その生徒の今までの全ての検診結果**を表示するようにしました。

### 主な変更点

1. **全レコードから検診結果を集約**
   - `studentRecords`から全ての健康記録を取得
   - 各レコードの検診結果を抽出して統合

2. **時系列表示（新しい順）**
   - 測定日が新しい順にソート
   - 最新の検診結果が一番上に表示

3. **検診タイプ別の表示**
   - 内科検診
   - 耳鼻科検診
   - 眼科検診
   - 聴力検査
   - 結核検査
   - 尿検査
   - 心電図

4. **レコード情報の表示**
   - 各検診結果に測定日とレコードIDを表示
   - レコードIDをクリックすると、そのレコードの詳細ページに移動

## 表示例

```
検査結果（全5件）
この生徒のすべての検診結果を新しい順に表示しています

┌─────────────────────────────────────┐
│ 内科検診              2025年11月3日 │ 記録#997
│ 検診結果: 喘息                      │
│ 診断結果: 喘息                      │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 耳鼻科検診            2025年11月3日 │ 記録#998
│ 分類: 耳                            │
│ 検診結果: 滲出性中耳炎              │
│ 所見: A                             │
│ 診断結果: 耳垢栓塞                  │
│ 処置: 治療中                        │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 耳鼻科検診            2025年11月3日 │ 記録#994
│ 分類: 鼻                            │
│ 検診結果: アレルギー性鼻炎          │
│ 所見: A                             │
│ 診断結果: アレルギー性鼻炎          │
│ 処置: 治療中                        │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 眼科検診              2025年10月30日│ 記録#993
│ 検診結果: アレルギー性結膜炎        │
└─────────────────────────────────────┘
```

## 使い方

### 詳細ページへのアクセス

1. **健康記録一覧ページ**から「詳細」ボタンをクリック
2. どのレコードをクリックしても、**その生徒の全ての検診結果**が表示されます

### 表示内容

- **ヘッダー**: 検査結果（全○件）
- **サブヘッダー**: この生徒のすべての検診結果を新しい順に表示しています
- **各検診カード**:
  - 検診タイプ（色分けされた左ボーダー）
  - 測定日
  - レコードIDリンク
  - 検診データ（検診結果、診断結果、処置など）

### 色分け

各検診タイプは色で区別されます：
- **内科検診**: 紫色
- **耳鼻科検診**: 緑色
- **眼科検診**: 青色
- **聴力検査**: 藍色
- **結核検査**: 黄色
- **尿検査**: ピンク色
- **心電図**: 赤色

## 技術詳細

### 実装箇所

`resources/js/views/health-records/HealthRecordShow.vue`

#### 新しいComputed Property

```javascript
const allExamResults = computed(() => {
  const results = [];
  
  // studentRecordsを新しい順にソート
  const sortedRecords = [...studentRecords.value].sort((a, b) => 
    new Date(b.measured_date) - new Date(a.measured_date)
  );
  
  sortedRecords.forEach(rec => {
    // 各検診タイプのデータを抽出
    // 内科検診、耳鼻科検診、眼科検診、聴力検査、結核検査、尿検査、心電図
  });
  
  return results;
});
```

#### テンプレートの変更

```vue
<div 
  v-for="(exam, index) in allExamResults" 
  :key="`exam-${exam.recordId}-${index}`"
  :class="`border-l-4 border-${exam.color}-500 pl-4 bg-gray-50 rounded p-4`"
>
  <!-- 検診結果の表示 -->
</div>
```

## メリット

1. **完全な履歴表示**
   - 生徒の健康状態を時系列で把握できる
   
2. **複数レコードの統合**
   - 別々のレコードに保存された検診結果も一箇所で確認可能
   
3. **ナビゲーションの改善**
   - レコードIDリンクから元のレコードに簡単にアクセス
   
4. **視覚的な分かりやすさ**
   - 色分けされた検診タイプ
   - 新しい順のソート

## 確認方法

1. ブラウザで **Ctrl+Shift+R**（Mac: Cmd+Shift+R）を押してキャッシュをクリア
2. 健康記録一覧ページで任意の「詳細」ボタンをクリック
3. その生徒の**全ての検診結果**が新しい順に表示されることを確認

## 注意事項

- 検診結果がない場合は「検診結果はまだ記録されていません」と表示されます
- 各検診カードには測定日とレコードIDが表示されます
- レコードIDをクリックすると、そのレコードの基本測定データ（身長、体重など）が確認できます
